---
title: 주인 없는 코드 고치기
author: haruair
type: post
date: -001-11-30T00:00:00+00:00
draft: true
history:
  - 
    from: https://www.haruair.com/?p=4425
    movedAt: 2018-09-13T22:02:40+00:00
lang: ko
slug: fix-the-code-without-the-owner
headline:
  - 잘 돌아가니 아무도 관심 없는 코드에 새 기능을 추가한다면 어떻게 해야할까, 번역.
categories:
  - 개발 이야기
  - 번역
tags:
  - company
  - maintenance

---
이 글은 [Bonnie Eisenman][1]의 [Notes on Modifying Unowned Code][2]를 번역한 글로 회사에서 주인 없는 코드에 새 기능을 추가한 경험을 설명한다.

회사에 있다보면 누가 개발한 지는 모르지만 오랜 시간동안 유용하게 사용하고 있는 도구를 목격할 때가 있다. 잘 동작하고 있기 때문에 누구도 들여다보지 않고 그만큼 낡은 구성의 코드가 오랜 기간동안 관심받지 못하고 돌아가는 경우가 많다.

얼마 전, 이런 비슷한 도구에 새 기능을 추가했었는데 15년 동안 의도와 다르게 붙은 로직이 많았고 테스트도 없었다. 더 많은 리소스를 요청했고 이 글과는 다르게 많은 부분을 뒤집었는데 사실 이렇게 이런 도구가 관심을 받고 리소스를 배정받는 일은 흔하지 않다. 이 글을 읽으면서 이런 코드를 접하게 되면 어떻게 확장하고 다듬어야 하는지 다시 생각해보게 되었다.

* * *

# 주인 없는 코드 고치기

최근에 회사에서 주인 없는 코드에 새 기능을 추가해야 했다.

방금 주인 없는 코드라고 했는데 무슨 의미일까? 내 생각엔 다음 같은 코드가 주인 없는 코드다.

  * 개선하거나 변경할 계획이 없는 코드.
  * 코드를 작성한 사람(또는 사람들)에게 물어볼 수 없는 경우. (더 이상 이 회사에서 일하지 않는다거나 아무도 누가 썼는지 모른다거나.)
  * 코드베이스에 친숙한 사람들이 있긴 하지만 누구도 담당하지 않고 있는 경우.

어떻게 이런 일이 있을까? 별로 이상한 일은 아니다. 유용한 소프트웨어를 작성하고 주변에서 사용하기 시작한다. 필요한 기능이 다 들어 있거나 더 고칠 필요가 없이 끝내도 되는 경우라면 그냥 넘어가도 문제가 없다. 모든 소프트웨어가 계속 변경될 필요는 없다. 그럼 이건 누가 소유하게 되는걸까? 당신 팀은 아니다. 더 이상 여기에 투자하고 있지 않으니 말이다. 이런 도구는 아무도 담당하지 않은 채 계속 유지되며 미래도 계속 쓰이게 된다.

이렇게 주인 없는 코드가 계속 돌아다니는 일이 나쁘다고는 생각하지 않는다. 대신에 가끔 이런 코드를 변경해야 하는 일이 있다. 그럼 무슨 일이 생길까?

내 경우에는 커피 한 잔 따라놓고 코드를 읽어 나갔다. 내가 하려던 작업은 기존 도구에 새로운 파일 포맷을 지원하도록 변경하는 일로 그다지 변경하는 범위 자체는 크지 않았다. 읽어야 했던 코드는 1,500 줄 가량의 Ruby 코드였다.

나는 그래도 운이 좋은 편이었다.

  * 코드 자체는 현재도 충분히 좋은 상태인걸 알았다. 다시 말하면 지금 동작하고 있다는 뜻이다. (게다가 최근에 다시 배포한 전력이 있었다! 대단해!)
  * README 파일이 있었다. 어떻게 로컬에서 구동할 수 있는지 설명하고 있었고 대부분 동작했다.
  * 코드에 주석이 있었다. 구조도 대부분 합리적이었다.
  * 회사에 남아있던 사람 중 한 명(!)이 코드를 읽고 어떻게 구동하고 배포하는지 알아냈다.

앞에서 말한 것처럼 몇 가지 냄새나는 부분은 있었다. 한 명이 작성했고 주인이 없는 코드였으니 놀랍지는 않았다.

  * 정리정돈 된 적 없는 TODO가 이곳저곳에 남겨져 있었다.
  * 자연적으로 성장한 코드를 볼 수 있다. 추상 계층이 있는데 어떤 부분이 문제인지 더 잘 이해하는 작성자 입장에서 구현되어 있었다. (단일 작성자가 개발하면 나타나는 일반적인 문제라고 생각한다. 동료가 코드를 검토하는 과정에서 임시 처방으로 작성된 이런 코드를 제거하게 된다.)
  * 개발자가 완전히 이해하기 어렵다. 회사에 한 사람을 지정해서 적절한 권한 설정을 줘야 한다. (스테이징 환경과 동작하는 개발 환경을 구하는 것이라든지, 배포 권한이라든지를 의미한다.)
  * 테스트가 없다.
  * 실제로는 실행되지 않는 죽은 코드가 많다.

이런 식으로 현재 존재하는 시스템에 뛰어드는 일은 그다지 나쁘지 않다. 적당한 크기인 경우에는 특히 그렇다. 나는 이렇게 해결했다.

  * 개발자 설정: 현재 상태 그대로 실행할 수 있는가?
  * git 히스토리를 살펴보고 현재 회사에 있는 사람 중 코드를 수정한 사람이 있는지 찾는다. (완벽하게도 한 명을 찾았다.)
  * 소스 코드를 읽고 어떤 구조로 코드가 작성되었는지, 어디에 새 기능을 추가해야 할 지 파악한다. 
      * &#8220;처음부터 시작하기&#8221; 방식으로 시작점부터 순차적으로 읽는 방법과 신중하게 `grep`으로 필요한 부분을 찾아보는 방법 두 가지를 적절히 섞어가며 접근한다.
      * Ruby에 엄청 친숙한 것은 아니였는데 우연히도 이 과정에서 block 등 많은 내용을 배울 수 있었다.
  * 내 새 기능을 추가했다. 가능한 한 작게 만들었고 내 로컬 환경에서 지속적으로 테스트를 했다.
  * 기존 코드에서 버그를 찾았고 고쳤다.
  * 내 새 기능을 계속 구현했다.
  * 내 새 기능이 동작하는지 수동으로 테스트했다.
  * 찾은 버그에 대한 테스트를 작성해서 다시 버그가 발생하는 상태로 돌아가지 않도록 했다.

이 시점에서 나는 몇 가지 선택지가 있었다. 이 코드를 전부 정돈 할 수도 있었다. 사실 가장 최근 코드를 수정한 사람이니 이 코드의 맥락 대부분을 이미 머리에 담고 있었기 때문에 불가능한 것도 아니었다.

  * 모든 기능에 대해 테스트를 작성하기
  * 사용하지 않는 코드를 삭제하는 정도로 코드 정돈하기
  * 내 새 기능을 추가한 후에 그낭 있는 그대로 두기

3번 선택지는 코드 질을 낮게 유지하는데 직접 기여하는 것이나 마찬가지다. 실제로는 더 나쁘게 만드는 일에 가깝다. (주인 없는 작은 코드에 코드를 더한 것이나 마찬가지기 때문이다. 웩.) 하지만! 이 결정은 비지니스 입장에서는 옳은 결정일 수 있다. 내가 해야 할 일 중에 더 우선 순위의 일이 있었고 이 문제를 그냥 남겨두는 것을 정당화 할 수 있었다.

하지만&#8230; 2번 선택지를 선택해도 그다지 많은 노력이 필요한 것은 아니였다. 그래서 내가 실제로 한 작업은 새 기능을 위한 테스트를 추가하고, 안쓰는 코드를 몇 삭제하는 정도로 작업을 마무리했다.

이 작업은 내 평소 일과와 다른, 재미있는 우회 도로였다! 새 코드를 내 머리에 끼얹는 작업, 내가 원하는 것을 찾기까지 이곳저곳을 찌르고 다니는 일은 즐거웠다. 게다가 내가 찾았을 때보다 좀 더 나은 상태로 만들기까지 했다. (하지만&#8230; 이런 걸 누가 알겠나?)

매번 이런 점을 기억해야 한다. 새로운 코드 베이스를 보는 일에 두려울 필요가 없다. 대신에 인내심과 탐색하고 찔러보고 돌아다닐 시간 정도가 필요하다. 지도가 없다고 해서 꼭 길을 잃어버린다는 이야기는 아닌 것처럼 말이다!

 [1]: https://twitter.com/brindelle
 [2]: https://blog.bonnieeisenman.com/blog/unowned-code/